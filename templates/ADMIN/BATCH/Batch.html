{% extends "base.html" %}
{% block extrastyles %}
{% endblock extrastyles %}
{% block extrajs %}
{% endblock extrajs %}
{% block content %}
    <!-- Page header -->
    <!-- back -->
    <!-- ./back -->
    <header class="">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <p class="text-muted mb-0">
                    <a class="text-muted"
                       style="text-decoration: none"
                       href="{% url 'AdminDashboard' %}">Datamanagement</a>
                    /
                    <a style="text-decoration: none"
                       class="text-muted"
                       href="{% url 'ViewBatches' %}">Batch</a>/
                    <span class="text-primary" style="text-decoration: none">New batch</span>
                </p>
                <h1 class="page-title">Add new Batch</h1>
            </div>
        </div>
    </header>
    <!-- message -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags == 'success' %}alert-success {% elif message.tags == 'error' %}alert-danger {% elif message.tags == 'warning' %}alert-warning {% elif message.tags == 'info' %}alert-info {% elif message.tags == 'debug' %}alert-secondary {% else %}alert-primary {% endif %}"
                 role="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}
    <!-- Batch Registration Form UI -->
    <div class="row">
        <div class="col-12 col-sm-11 col-lg-12 border rounded mb-5 mb-sm-5">
            <div class="card-body">
                <!-- .form -->
                <form method="post">
                    {% csrf_token %}
                    <!-- .fieldset -->
                    <fieldset>
                        <legend>Register New Batch</legend>
                        <!-- .form-group for Batch Name (name) -->
                        <div class="form-group">
                            <label for="id_name">
                                Batch Name
                                <abbr title="Required">*</abbr>
                            </label>
                            <input type="text"
                                   class="form-control placeholder-shown"
                                   id="id_name"
                                   placeholder="eg: Python Jan 2026 Morning"
                                   name="name"
                                   required />
                        </div>
                        <!-- /.form-group -->
                        <!-- .form-group for Course (course - ForeignKey) -->
                        <div class="form-group">
                            <label for="id_course">
                                Course
                                <abbr title="Required">*</abbr>
                            </label>
                            <select class="form-control" id="id_course" name="course" required>
                                <option value="" disabled selected>Select a Course</option>
                                <!-- Placeholder options (will be populated by Django) -->
                                <!-- DTL Loop starts here -->
                                {% for course in courses %}
                                    <!-- value is the ID (for database), text is what user sees -->
                                    <option value="{{ course.id }}">{{ course.name }}</option>
                                    <!-- Note: Use {{ course.title }} or {{ course }} depending on your Course model -->
                                {% endfor %}
                                <!-- DTL Loop ends here -->
                            </select>
                        </div>
                        <!-- /.form-group -->
                        <!-- .form-group for Instructor (instructor - ForeignKey, Optional) -->
                        <div class="form-group">
                            <label for="id_instructor">Instructor</label>
                            <select class="form-control" id="id_instructor" name="instructor">
                                <!-- Option for null/blank field -->
                                <option value="" selected>No Instructor Assigned (Optional)</option>
                                <!-- Placeholder options (will be populated by Django) -->
                                {% if instructors %}
                                    {% for instructor in instructors %}<option value="{{ instructor.id }}">{{ instructor.name }}</option>{% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <!-- /.form-group -->
                        <div class="row">
                            <!-- .form-group for Start Date (start_date) -->
                            <div class="form-group col-md-6">
                                <label for="id_start_date">
                                    Start Date
                                    <abbr title="Required">*</abbr>
                                </label>
                                <input type="date"
                                       class="form-control"
                                       id="id_start_date"
                                       name="start_date"
                                       required />
                            </div>
                            <!-- /.form-group -->
                            <!-- .form-group for End Date (end_date) -->
                            <div class="form-group col-md-6">
                                <label for="id_end_date">
                                    End Date
                                    <abbr title="Required">*</abbr>
                                </label>
                                <input type="date"
                                       class="form-control"
                                       id="id_end_date"
                                       name="end_date"
                                       required />
                            </div>
                            <!-- /.form-group -->
                        </div>
                        <!-- .form-group for Status (status - Choices) -->
                        <div class="form-group">
                            <label for="id_status">
                                Status
                                <abbr title="Required">*</abbr>
                            </label>
                            <select class="form-control" id="id_status" name="status" required>
                                <!-- Options based on Batch.Status choices -->
                                <option value="UPCOMING" selected>Upcoming</option>
                                <option value="ONGOING">Ongoing</option>
                                <option value="COMPLETED">Completed</option>
                                <option value="CANCELLED">Cancelled</option>
                            </select>
                        </div>
                        <!-- /.form-group -->
                        <!-- submit button -->
                        <button type="submit"
                                class="btn btn-outline-primary d-flex justify-content-center w-100 mt-4">
                            Add Batch
                        </button>
                    </fieldset>
                    <!-- /.fieldset -->
                </form>
                <!-- /.form -->
            </div>
        </div>
        <!-- View Batches Button Block -->
    </div>
    <!-- ./Batch Registration Form UI -->
{% endblock content %}
{% block bottomjs %}
    <script>
document.addEventListener("DOMContentLoaded", function() {
    // 1. Define the specific Sidebar Link we want to highlight
    // We let Django generate the string for us
    const targetUrl = "{% url 'ViewBatches' %}";

    // 2. Find the <a> tag in the sidebar that matches this URL
    // We search specifically inside #stacked-menu
    const activeLink = document.querySelector(`#stacked-menu .menu-link[href="${targetUrl}"]`);

    if (activeLink) {
        // 3. Highlight the Link (Students)
        activeLink.classList.add('active');

        // 4. Highlight the <li> wrapper
        const parentItem = activeLink.closest('.menu-item');
        if (parentItem) {
            parentItem.classList.add('has-active');
        }

        // 5. Open the Parent Dropdown (Data Management)
        // Find the <ul> (menu) holding this link
        const parentMenu = activeLink.closest('ul.menu');
        if (parentMenu) {
            // Find the <li> (Data Management) holding that <ul>
            const grandParent = parentMenu.closest('.menu-item.has-child');
            if (grandParent) {
                // 'has-open' expands the menu, 'has-active' highlights the folder icon
                grandParent.classList.add('has-active', 'has-open');
            }
        }
    }
});
    </script>
{% endblock bottomjs %}

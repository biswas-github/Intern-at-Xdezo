{% extends "base.html" %}
{% block extrastyles %}
{% endblock extrastyles %}
{% block extrajs %}
{% endblock extrajs %}
{% block content %}
    <!-- 1. DATA BRIDGE (Pass Django Data to JS) -->
    {{ chart_labels|json_script:"revenue-labels" }}
    {{ chart_data|json_script:"revenue-data" }}
    <!-- Page Header -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'AdminDashboard' %}">DataManagement</a>
            </li>
            <li class="breadcrumb-item">
                <a href="#">Analytics</a>
            </li>
            <li class="breadcrumb-item active">Monthly Revenue</li>
        </ol>
    </nav>
    <div class="d-flex justify-content-between align-items-center">
        <h1 class="page-title">Financial Overview</h1>
        <!-- Total Revenue Badge -->
        <span class="badge badge-lg badge-success shadow-sm">Total: Rs. {{ total_revenue }}</span>
    </div>
    <div class="page-section">
        <!-- 2. CHART SECTION -->
        <div class="card card-fluid">
            <div class="card-body">
                <h3 class="card-title mb-4">Revenue Trend</h3>
                <div class="chart-container"
                     style="position: relative;
                            height: 350px;
                            width: 100%">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>
        <!-- 3. DETAILED TABLE SECTION -->
        <div class="card card-fluid">
            <div class="card-header border-0">
                <div class="d-flex align-items-center">
                    <span class="mr-auto font-weight-bold">Monthly Breakdown</span>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover table-striped">
                    <thead class="thead-light">
                        <tr>
                            <th style="min-width:200px">Month</th>
                            <th>Revenue Collected</th>
                            <!-- Visual Placeholder -->
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in table_data %}
                            <tr>
                                <td class="align-middle">
                                    <strong>{{ row.month }}</strong>
                                </td>
                                <td class="align-middle font-weight-bold text-success">Rs. {{ row.amount }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-4">No revenue data available yet.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock content %}
{% block bottomjs %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", function() {
    
    // 1. Get Data
    const labels = JSON.parse(document.getElementById('revenue-labels').textContent);
    const dataPoints = JSON.parse(document.getElementById('revenue-data').textContent);

    const ctx = document.getElementById('revenueChart').getContext('2d');

    // 2. Create Gradient (Green fade effect)
    let gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(40, 167, 69, 0.5)'); // Green top
    gradient.addColorStop(1, 'rgba(40, 167, 69, 0.0)'); // Transparent bottom

    // 3. Render Chart
    new Chart(ctx, {
        type: 'line', // Line chart is best for time trends
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue (Rs)',
                data: dataPoints,
                borderColor: '#28a745', // Bootstrap Success Green
                backgroundColor: gradient,
                borderWidth: 2,
                pointBackgroundColor: '#fff',
                pointBorderColor: '#28a745',
                pointRadius: 4,
                pointHoverRadius: 6,
                fill: true, // Fills the area under the line
                tension: 0.3 // Makes the line slightly curved (smooth)
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: '#f0f0f0'
                    },
                    ticks: {
                        // Add 'Rs.' to Y-axis numbers
                        callback: function(value) {
                            return 'Rs. ' + value;
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    callbacks: {
                        label: function(context) {
                            return ' Revenue: Rs. ' + context.parsed.y;
                        }
                    }
                }
            }
        }
    });
});
    </script>
{% endblock bottomjs %}

{% extends "base.html" %}
{% block extrastyles %}
{% endblock extrastyles %}
{% block extrajs %}
{% endblock extrajs %}
{% block content %}
    <!-- ======================================================= -->
    <!-- COMPACT TIMETABLE VIEW (Fit to Screen)                  -->
    <!-- ======================================================= -->
    <style>
    /* 1. LAYOUT CONTROLLER */
    /* This forces the container to fit exact screen height minus headers */
    .timetable-wrapper-fixed {            /* Enables internal scrolling */
        background: white;
        border: 1px solid #c8c8c8;
        border-radius: 4px;
        position: relative;
    }

    /* 2. TABLE BASICS */
    .compact-table {
        width: 100%;
        border-collapse: separate; /* Required for sticky to work */
        border-spacing: 0;
        table-layout: fixed; /* Forces columns to respect width */
    }

    /* 3. COLUMNS & ROWS */
    .compact-table th, 
    .compact-table td {
        border-right: 1px solid #e0e0e0;
        border-bottom: 1px solid #e0e0e0;
        height: 50px; /* Fixed compact height */
        padding: 0;
        box-sizing: border-box;
    }

    /* Column Widths */
    .col-time { width: 40px; }
    .col-room { width: 140px; } /* Adjust based on preference */

    /* 4. STICKY HEADERS (Top Row) */
    .compact-table thead th {
        position: sticky;
        top: 0;
        z-index: 20;
        background-color: #f1f3f5;
        color: #343a40;
        font-size: 0.8rem;
        font-weight: 700;
        text-align: center;
        border-bottom: 2px solid #ced4da;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    /* 5. STICKY TIME COLUMN (Left Col) */
    .compact-table tbody th {
        position: sticky;
        left: 0;
        z-index: 10;
        background-color: #f8f9fa;
        font-family: monospace;
        font-size: 0.75rem;
        text-align: center;
        border-right: 2px solid #dee2e6;
    }

    /* Top-Left Intersection (Z-Index King) */
    .compact-table thead th:first-child {
        position: sticky;
        left: 0;
        top: 0;
        z-index: 30;
        background-color: #e9ecef;
        border-right: 2px solid #ced4da;
    }

    /* 6. CELL CONTENT */
    .cell-data {
        width: 50%;
        height: 100%;
        margin: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 0 6px;
        font-size: 0.75rem;
        white-space: nowrap; /* Prevents wrapping */
        overflow: hidden;
        border-radius: 0.3rem;
        text-align: center;
       
    }

    /* Occupied Style */
    .cell-occupied {
        color: white;
        transition: 0.1s;
        cursor: pointer;
        text-shadow: 0 1px 1px rgba(0,0,0,0.3);
    }
    .cell-occupied:hover {
        opacity: 0.9;
    }

    /* Empty Style */
    .cell-empty {
        background-color: #fff;
    }
    .cell-empty:hover {
        background-color: #f8f9fa; /* Hover effect for empty cells */
    }

    </style>
    <div class="page-section  p-2">
        <!-- Header -->
        <div class="card card-fluid border-0 shadow-sm mb-0 ">
            <div class="card-header bg-white border-0 py-2 d-flex justify-content-between align-items-center ps-1  p-1">
                <h6 class="mb-0 font-weight-bold">
                    <i class="fa fa-table text-primary me-2"></i>Timetable Matrix
                </h6>
                <div class="small text-muted">
                    <span class="badge badge-subtle badge-success me-1">Occupied</span>
                    <span class="badge badge-subtle badge-light border">Free</span>
                </div>
            </div>
            <!-- ./header -->
            <!-- Card Wrapper -->
            <!-- THE SCROLLABLE AREA -->
            <div class="timetable-wrapper-fixed  vh-100 card-body">
                <table style="height: 100vh;" class="compact-table border-none  ">
                    <thead>
                        <tr>
                            <!-- Top Left: Time Header -->
                            <th class="col-time">Time</th>
                            <!-- Room Headers -->
                            {% for room in room_headers %}
                                <th class="col-room">
                                    <div class="text-truncate px-1" title="{{ room }}">{{ room }}</div>
                                </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in timetable_rows %}
                            <tr>
                                <!-- Time Label (Sticky Left) -->
                                <th>{{ row.time }}</th>
                                <!-- Room Cells -->
                                {% for cell in row.cells %}
                                    <td class="p-2">
                                        {% if cell.is_occupied %}
                                            <!-- Occupied Cell -->
                                            <div class="cell-data cell-occupied  "
                                                 style="background-color: {{ cell.color }}"
                                                 title="{{ cell.batch }} | {{ cell.instructor }}">
                                                <div class="fw-bold text-truncate">{{ cell.batch }}</div>
                                                <div class="text-truncate" style="opacity: 0.9; font-size: 0.7rem;">{{ cell.instructor }}</div>
                                            </div>
                                        {% else %}
                                            <!-- Empty Cell -->
                                            <div class="cell-data cell-empty bg-success ">Free room</div>
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock content %}
{% block bottomjs %}
{% endblock bottomjs %}

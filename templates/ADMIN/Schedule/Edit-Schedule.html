{% extends "base.html" %}
{% block extrastyles %}
{% endblock extrastyles %}
{% block extrajs %}
{% endblock extrajs %}
{% block content %}
    <!-- Page Header & Breadcrumbs -->
    <header class="page-title-bar mb-0 mb-sm-0">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'AdminDashboard' %}">DataManagement</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'ViewSchedule' %}">Schedules</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Update Session</li>
            </ol>
        </nav>
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="page-title">Edit Class Session</h1>
        </div>
    </header>
    <!-- Page Content Section -->
    <div class="page-section">
        <div class="row justify-content-start">
            <!-- Centered Column -->
            <div class="col-12 col-sm-12 col-lg-12">
                <!-- THE CARD WRAPPER -->
                <div class="card">
                    <!-- THE CARD BODY -->
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            <fieldset>
                                <legend>Session Details</legend>
                                <!-- Batch -->
                                <div class="form-group">
                                    <label for="id_batch">Batch</label>
                                    <select class="form-control" id="id_batch" name="batch" required>
                                        <option value="" disabled>Select Batch</option>
                                        {% for batch in batches %}
                                            <option value="{{ batch.id }}"
                                                    {% if batch.id == schedule.batch.id %}selected{% endif %}>
                                                {{ batch.name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <!-- Date -->
                                <div class="form-group">
                                    <label for="id_date">
                                        Date <abbr title="Required">*</abbr>
                                    </label>
                                    <!-- formatting date to Y-m-d is required for type="date" inputs -->
                                    <input type="date"
                                           class="form-control"
                                           id="id_date"
                                           name="date"
                                           value="{{ schedule.date|date:'Y-m-d' }}"
                                           required>
                                </div>
                                <!-- Time Slot -->
                                <div class="form-row">
                                    <div class="col-md-6 mb-3">
                                        <label for="id_start_time">
                                            Start Time <abbr title="Required">*</abbr>
                                        </label>
                                        <!-- formatting time to H:i (24hr format) is required for type="time" inputs -->
                                        <input type="time"
                                               class="form-control"
                                               id="id_start_time"
                                               name="start_time"
                                               value="{{ schedule.start_time|time:'H:i' }}"
                                               required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="id_end_time">
                                            End Time <abbr title="Required">*</abbr>
                                        </label>
                                        <input type="time"
                                               class="form-control"
                                               id="id_end_time"
                                               name="end_time"
                                               value="{{ schedule.end_time|time:'H:i' }}"
                                               required>
                                    </div>
                                </div>
                                <!-- Resources (Instructor & Room) -->
                                <div class="form-row">
                                    <div class="col-md-6 mb-3">
                                        <label for="id_instructor">Instructor</label>
                                        <select class="form-control" id="id_instructor" name="instructor">
                                            <option value="">Select Instructor</option>
                                            {% for instructor in instructors %}
                                                <option value="{{ instructor.id }}"
                                                        {% if instructor.id == schedule.instructor.id %}selected{% endif %}>
                                                    {{ instructor.full_name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="id_classroom">Classroom</label>
                                        <select class="form-control" id="id_classroom" name="classroom">
                                            <option value="">Select Room</option>
                                            {% for classroom in classrooms %}
                                                <option value="{{ classroom.id }}"
                                                        {% if classroom.id == schedule.classroom.id %}selected{% endif %}>
                                                    {{ classroom.name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <!-- Status -->
                                <div class="form-group">
                                    <label for="id_status">Session Status</label>
                                    <select class="form-control" id="id_status" name="status">
                                        <option value="SCHEDULED"
                                                {% if schedule.status == "SCHEDULED" %}selected{% endif %}>
                                            Scheduled
                                        </option>
                                        <option value="COMPLETED"
                                                {% if schedule.status == "COMPLETED" %}selected{% endif %}>
                                            Completed
                                        </option>
                                        <option value="CANCELLED"
                                                {% if schedule.status == "CANCELLED" %}selected{% endif %}>
                                            Cancelled
                                        </option>
                                    </select>
                                </div>
                                <!-- Action Buttons -->
                                <div class="d-flex flex-column mt-4">
                                    <button type="submit" class="btn btn-outline-primary w-100">
                                        <i class="fas fa-save mr-2"></i> Save Changes
                                    </button>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
        </div>
    </div>
{% endblock content %}
{% block bottomjs %}
    <script>
document.addEventListener("DOMContentLoaded", function() {
    // 1. Define the specific Sidebar Link we want to highlight
    // We let Django generate the string for us
    const targetUrl = "{% url 'ViewSchedule' %}";

    // 2. Find the <a> tag in the sidebar that matches this URL
    // We search specifically inside #stacked-menu
    const activeLink = document.querySelector(`#stacked-menu .menu-link[href="${targetUrl}"]`);

    if (activeLink) {
        // 3. Highlight the Link (Students)
        activeLink.classList.add('active');

        // 4. Highlight the <li> wrapper
        const parentItem = activeLink.closest('.menu-item');
        if (parentItem) {
            parentItem.classList.add('has-active');
        }

        // 5. Open the Parent Dropdown (Data Management)
        // Find the <ul> (menu) holding this link
        const parentMenu = activeLink.closest('ul.menu');
        if (parentMenu) {
            // Find the <li> (Data Management) holding that <ul>
            const grandParent = parentMenu.closest('.menu-item.has-child');
            if (grandParent) {
                // 'has-open' expands the menu, 'has-active' highlights the folder icon
                grandParent.classList.add('has-active', 'has-open');
            }
        }
    }
});
    </script>
{% endblock bottomjs %}

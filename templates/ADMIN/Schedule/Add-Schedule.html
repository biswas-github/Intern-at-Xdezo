{% extends "base.html" %}
{% block extrastyles %}
{% endblock extrastyles %}
{% block extrajs %}
{% endblock extrajs %}
{% block content %}
    <!-- Page Header & Breadcrumbs -->
    <header class="page-title-bar mb-0 mb-sm-0">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'AdminDashboard' %}">DataManagement</a>
                </li>
                <li class="breadcrumb-item">
                    <!-- Replace with your actual View Schedules URL -->
                    <a href="{% url 'ViewSchedule' %}">Schedules</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Add Session</li>
            </ol>
        </nav>
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="page-title">Create Class Schedule</h1>
        </div>
    </header>
    <!-- Page Content Section -->
    <div class="page-section">
        <div class="row">
            <!-- Center the form nicely -->
            <div class="col-12 col-sm-12 col-lg-12 border rounded mb-5 mb-sm-5 bg-white">
                <div class="card-body">
                    <!-- 1. TOGGLE BUTTONS (Switcher) -->
                    <div class="text-center mb-4 pb-3 border-bottom">
                        <div class="btn-group" role="group">
                            <button type="button"
                                    class="btn btn-primary"
                                    id="btn-recurring"
                                    onclick="switchMode('recurring')">
                                <i class="fas fa-sync-alt mr-2"></i> Recurring Mode
                            </button>
                            <button type="button"
                                    class="btn btn-outline-primary"
                                    id="btn-single"
                                    onclick="switchMode('single')">
                                <i class="fas fa-calendar-day mr-2"></i> Single Session
                            </button>
                        </div>
                        <p class="text-muted small mt-2" id="helper-text">
                            Auto-generate sessions for specific days (Mon, Wed, Fri) based on Batch duration.
                        </p>
                    </div>
                    <!-- ================= FORM A: RECURRING SCHEDULE (Default) ================= -->
                    <form id="form-recurring" method="post">
                        {% csrf_token %}
                        <fieldset>
                            <input type="hidden" name="form_type" value="recurring">
                            <legend>Recurring Settings</legend>
                            <!-- Batch -->
                            <div class="form-group">
                                <label for="rec_batch">
                                    Batch <abbr title="Required">*</abbr>
                                </label>
                                <select class="form-control" id="rec_batch" name="batch" required>
                                    <option value="" disabled selected>Select Batch</option>
                                    {% for batch in batches %}<option value="{{ batch.id }}">{{ batch.name }}</option>{% endfor %}
                                </select>
                                <small class="form-text text-muted">Sessions will be created from the Batch's start to end date.</small>
                            </div>
                            <!-- Days Selection -->
                            <div class="form-group">
                                <label class="d-block">
                                    Repeat On <abbr title="Required">*</abbr>
                                </label>
                                <div class="custom-control custom-control-inline custom-checkbox">
                                    <input type="checkbox"
                                           class="custom-control-input"
                                           id="day_sun"
                                           name="days"
                                           value="6">
                                    <label class="custom-control-label" for="day_sun">Sun</label>
                                </div>
                                <div class="custom-control custom-control-inline custom-checkbox">
                                    <input type="checkbox"
                                           class="custom-control-input"
                                           id="day_mon"
                                           name="days"
                                           value="0">
                                    <label class="custom-control-label" for="day_mon">Mon</label>
                                </div>
                                <div class="custom-control custom-control-inline custom-checkbox">
                                    <input type="checkbox"
                                           class="custom-control-input"
                                           id="day_tue"
                                           name="days"
                                           value="1">
                                    <label class="custom-control-label" for="day_tue">Tue</label>
                                </div>
                                <div class="custom-control custom-control-inline custom-checkbox">
                                    <input type="checkbox"
                                           class="custom-control-input"
                                           id="day_wed"
                                           name="days"
                                           value="2">
                                    <label class="custom-control-label" for="day_wed">Wed</label>
                                </div>
                                <div class="custom-control custom-control-inline custom-checkbox">
                                    <input type="checkbox"
                                           class="custom-control-input"
                                           id="day_thu"
                                           name="days"
                                           value="3">
                                    <label class="custom-control-label" for="day_thu">Thu</label>
                                </div>
                                <div class="custom-control custom-control-inline custom-checkbox">
                                    <input type="checkbox"
                                           class="custom-control-input"
                                           id="day_fri"
                                           name="days"
                                           value="4">
                                    <label class="custom-control-label" for="day_fri">Fri</label>
                                </div>
                            </div>
                            <!-- Time Slot -->
                            <div class="form-row">
                                <div class="col-md-6 mb-3">
                                    <label for="rec_start_time">
                                        Start Time <abbr title="Required">*</abbr>
                                    </label>
                                    <input type="time"
                                           class="form-control"
                                           id="rec_start_time"
                                           name="start_time"
                                           required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="rec_end_time">
                                        End Time <abbr title="Required">*</abbr>
                                    </label>
                                    <input type="time"
                                           class="form-control"
                                           id="rec_end_time"
                                           name="end_time"
                                           required>
                                </div>
                            </div>
                            <!-- Instructor & Room -->
                            <div class="form-row">
                                <div class="col-md-6 mb-3">
                                    <label for="rec_instructor">Instructor</label>
                                    <select class="form-control" id="rec_instructor" name="instructor">
                                        {% for instructor in instructors %}<option value="{{ instructor.id }}">{{ instructor.full_name }}</option>{% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="rec_classroom">Classroom</label>
                                    <select class="form-control" id="rec_classroom" name="classroom">
                                        {% for classroom in classrooms %}<option value="{{ classroom.id }}">{{ classroom.name }}</option>{% endfor %}
                                    </select>
                                </div>
                            </div>
                            <!-- Submit -->
                            <div class="d-flex flex-column mt-4">
                                <button type="submit" class="btn btn-outline-primary w-100">Generate Schedules</button>
                                <div class="text-center mt-3"></div>
                            </div>
                        </fieldset>
                    </form>
                    <!-- ================= FORM B: SINGLE SESSION (Hidden) ================= -->
                    <form id="form-single" method="post"  style="display: none">
                        {% csrf_token %}
                        <fieldset>
                            <input type="hidden" name="form_type" value="single">
                            <legend>Single Session Details</legend>
                            <!-- Batch -->
                            <div class="form-group">
                                <label for="sin_batch">
                                    Batch <abbr title="Required">*</abbr>
                                </label>
                                <select class="form-control" id="sin_batch" name="batch" required>
                                    <option value="" disabled selected>Select Batch</option>
                                    {% for batch in batches %}<option value="{{ batch.id }}">{{ batch.name }}</option>{% endfor %}
                                </select>
                            </div>
                            <!-- Specific Date -->
                            <div class="form-group">
                                <label for="sin_date">
                                    Date <abbr title="Required">*</abbr>
                                </label>
                                <input type="date" class="form-control" id="sin_date" name="date" required>
                            </div>
                            <!-- Time Slot -->
                            <div class="form-row">
                                <div class="col-md-6 mb-3">
                                    <label for="sin_start_time">
                                        Start Time <abbr title="Required">*</abbr>
                                    </label>
                                    <input type="time"
                                           class="form-control"
                                           id="sin_start_time"
                                           name="start_time"
                                           required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="sin_end_time">
                                        End Time <abbr title="Required">*</abbr>
                                    </label>
                                    <input type="time"
                                           class="form-control"
                                           id="sin_end_time"
                                           name="end_time"
                                           required>
                                </div>
                            </div>
                            <!-- Instructor & Room -->
                            <!-- Instructor & Room -->
                            <div class="form-row">
                                <div class="col-md-6 mb-3">
                                    <label for="rec_instructor">Instructor</label>
                                    <select class="form-control" id="rec_instructor" name="instructor">
                                        {% for instructor in instructors %}<option value="{{ instructor.id }}">{{ instructor.full_name }}</option>{% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="rec_classroom">Classroom</label>
                                    <select class="form-control" id="rec_classroom" name="classroom">
                                        {% for classroom in classrooms %}<option value="{{ classroom.id }}">{{ classroom.name }}</option>{% endfor %}
                                    </select>
                                </div>
                            </div>
                            <!-- Status -->
                            <div class="form-group">
                                <label for="sin_status">Status</label>
                                <select class="form-control" id="sin_status" name="status">
                                    <option value="SCHEDULED" selected>Scheduled</option>
                                    <option value="COMPLETED">Completed</option>
                                    <option value="CANCELLED">Cancelled</option>
                                </select>
                            </div>
                            <!-- Submit -->
                            <div class="d-flex flex-column mt-4">
                                <button type="submit" class="btn btn-outline-primary w-100">Add Single Session</button>
                                <div class="text-center mt-3"></div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block bottomjs %}
    <!-- JavaScript to Switch Forms -->
    <script>
function switchMode(mode) {
    const btnRecurring = document.getElementById('btn-recurring');
    const btnSingle = document.getElementById('btn-single');
    const formRecurring = document.getElementById('form-recurring');
    const formSingle = document.getElementById('form-single');
    const helperText = document.getElementById('helper-text');

    if (mode === 'recurring') {
        // Show Recurring
        formRecurring.style.display = 'block';
        formSingle.style.display = 'none';
        
        // Update Button Styles
        btnRecurring.classList.add('btn-primary');
        btnRecurring.classList.remove('btn-outline-primary');
        btnSingle.classList.add('btn-outline-primary');
        btnSingle.classList.remove('btn-primary');
        
        helperText.textContent = "Auto-generate sessions for specific days (Mon, Wed, Fri) based on Batch duration.";
    } else {
        // Show Single
        formRecurring.style.display = 'none';
        formSingle.style.display = 'block';
        
        // Update Button Styles
        btnSingle.classList.add('btn-primary');
        btnSingle.classList.remove('btn-outline-primary');
        btnRecurring.classList.add('btn-outline-primary');
        btnRecurring.classList.remove('btn-primary');
        
        helperText.textContent = "Create one specific session manually. Useful for extra classes or rescheduling.";
    }
}
    </script>
{% endblock bottomjs %}
